<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>esp32_BNO08x: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">esp32_BNO08x<span id="projectnumber">&#160;1.3</span>
   </div>
   <div id="projectbrief">C++ BNO08x IMU driver component for esp-idf.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__d_1_2development_2git_2imu__update_2bno08x__update_2components_2esp32___b_n_o08x_2_r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">README</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Table of Contents.</p>
<p><a class="anchor" id="readme-top"></a> <img src="README_images/esp32_BNO08x_banner.png" alt="image" class="inline"/></p>
<ol>
<li>
<a href="#about">About</a>  </li>
<li>
<a href="#getting-started">Getting Started</a> <ul>
<li>
<a href="#wiring">Wiring</a> </li>
<li>
<a href="#adding-to-project">Adding to Project</a> </li>
<li>
<a href="#menuconfig">Menuconfig</a> </li>
<li>
<a href="#examples">Examples</a> </li>
</ul>
</li>
<li>
<a href="#unit-tests">Unit Tests</a> <ul>
<li>
<a href="#running-tests">Running Tests</a> </li>
<li>
<a href="#adding-tests">Adding Tests</a> </li>
</ul>
</li>
<li>
<a href="#documentation">Documentation</a> </li>
<li>
<a href="#program-flowcharts">Program Flowcharts</a> </li>
<li>
<a href="#acknowledgements">Acknowledgements</a> </li>
<li>
<a href="#license">License</a> </li>
<li>
<a href="#contact">Contact</a> </li>
</ol>
<h2><a class="anchor" id="autotoc_md0"></a>
About</h2>
<p>esp32_BNO08x is a C++ component for esp-idf v5.x, serving as a driver for both BNO080 and BNO085 IMUs. <br  />
</p>
<p>Originally based on the SparkFun BNO080 Arduino Library, it has since diverged significantly in implementation, taking a multi-tasked approach to avoid wasting CPU time polling the HINT pin of the IMU. Currently, only SPI is supported. There are no plans to support I2C due to unpredictable behavior caused by an esp32 I2C driver silicon bug. UART support may be implemented in the future.</p>
<p align="right"><b>NOTE: If you are here because this most recent update broke your code:</b> <br  />
 You can still use the old version on the <code>no_sh2_HAL</code> branch of this repo. It will no longer receive support. It's highly recommended you update your code base to this version as it uses the official <a href="https://github.com/ceva-dsp/sh2">Hillcrest Labs sh2 HAL lib</a> to handle sh2 SHTP communication with the IMU, instead of my own implementation. It is better tested and more reliable at the cost of slightly more overhead. </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Getting Started</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Wiring</h3>
<p>The default wiring is depicted below, it can be changed at driver initialization (see example section). <br  />
</p>
<p><b>If your ESP does not have the GPIO pin numbers depicted below, you must change the default GPIO settings in menuconfig</b>. See the Menuconfig section.</p>
<p align="right"><img src="README_images/esp32_BNO08x_wiring.png" alt="image" class="inline"/> </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Adding to Project</h3>
<ol type="1">
<li><p class="startli">Create a "components" directory in the root workspace directory of your esp-idf project if it does not exist already. <br  />
</p>
<p class="startli">In workspace directory: <br  />
 </p><div class="fragment"><div class="line">mkdir components</div>
</div><!-- fragment --></li>
<li><p class="startli">Cd into the components directory and clone the esp32_BNO08x repo.</p>
<div class="fragment"><div class="line">cd components</div>
<div class="line">git clone https://github.com/myles-parfeniuk/esp32_BNO08x.git</div>
</div><!-- fragment --></li>
<li>Ensure you clean your esp-idf project before rebuilding. <br  />
 Within esp-idf enabled terminal: <div class="fragment"><div class="line">idf.py fullclean</div>
</div><!-- fragment --> </li>
</ol>
<p>(<a href="#readme-top">back to top</a>)</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Menuconfig</h3>
<p>This library provides a menuconfig menu configured in Kconfig.projbuild. It contains settings to control the default GPIO and a few other things. <br  />
</p>
<p>To access the menu:</p>
<ol type="1">
<li>Within esp-idf enabled terminal, execute the menuconfig command: <div class="fragment"><div class="line">idf.py menuconfig</div>
</div><!-- fragment --></li>
<li>Scroll down to the esp_BNO08x menu and enter it, if you're using vsCode you may have to use the "j" and "k" keys instead of the arrow keys. <img src="README_images/esp32_BNO08x_menuconfig_1.png" alt="image" class="inline"/></li>
<li><p class="startli" align="right">Modify whatever settings you'd like from the sub menus. <br  />
 <img src="README_images/esp32_BNO08x_menuconfig_2.png" alt="image" class="inline"/></p><ul>
<li>The GPIO Configuration menu allows for the default GPIO pins to be modified.</li>
<li>The SPI Configuration menu allows for the default host peripheral, SCLK frequency, and SPI queue size to be modified.</li>
<li>The Tasks menu allows for the stack size of the three tasks utilized by this library to be modified.</li>
<li>The Callbacks menu allows for the size of the callback queue and maximum amount of callbacks to be modified.</li>
<li>The Timeouts menu allows the length of various timeouts/delays to be set.</li>
<li>The Logging menu allows for the enabling and disabling of serial log/print statements for production code. </li>
</ul>
<p class="startli">(<a href="#readme-top">back to top</a>)</p>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md5"></a>
Examples</h3>
<p>There are two ways data returned from the <a class="el" href="class_b_n_o08x.html" title="BNO08x IMU driver class.">BNO08x</a> can be accessed with this library:</p>
<ol type="1">
<li><b>Polling Method with</b> <code>data_available()</code> <b>Function</b>:<ul>
<li>See the <b>Polling Example</b> below.</li>
</ul>
</li>
<li><b>Callback Registration with</b> <code>register_cb()</code> <b>Function</b>:<ul>
<li>See the <b>Call-Back Function Example</b> below.</li>
</ul>
</li>
</ol>
<h4><a class="anchor" id="autotoc_md6"></a>
Polling Example</h4>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_b_n_o08x_8hpp.html">BNO08x.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">constexpr</span> <span class="keywordtype">char</span> *TAG = <span class="stringliteral">&quot;Main&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> app_main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_class" href="class_b_n_o08x.html">BNO08x</a> imu;</div>
<div class="line">    <span class="comment">// if a custom wiring scheme is desired instead of default:</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">    bno08x_config_t imu_config;        //create config struct</span></div>
<div class="line"><span class="comment">    imu_config.io_mosi = GPIO_NUM_X;   //assign pin</span></div>
<div class="line"><span class="comment">    imu_config.io_miso = GPIO_NUM_X;   //assign pin</span></div>
<div class="line"><span class="comment">    //etc...</span></div>
<div class="line"><span class="comment">    BNO08x imu(imu_config);            //pass config to BNO08x constructor</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// initialize imu</span></div>
<div class="line">    <span class="keywordflow">if</span> (!imu.<a class="code hl_function" href="class_b_n_o08x.html#aea8e2c6dd7a2c9899479a7f39fe94798">initialize</a>())</div>
<div class="line">    {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Init failure, returning from main.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// enable game rotation vector and calibrated gyro reports</span></div>
<div class="line">    imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">rv_game</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a3012b77fd80f2c34e57d5a23299f1470">enable</a>(100000UL);  <span class="comment">// 100,000us == 100ms report interval</span></div>
<div class="line">    imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a3012b77fd80f2c34e57d5a23299f1470">enable</a>(100000UL); <span class="comment">// 100,000us == 100ms report interval</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// block until new report is detected</span></div>
<div class="line">        <span class="keywordflow">if</span> (imu.<a class="code hl_function" href="class_b_n_o08x.html#a367d525d1c0ba119b3dca3067bb5bccc">data_available</a>())</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// check for game rotation vector report</span></div>
<div class="line">            <span class="keywordflow">if</span> (imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">rv_game</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a74f6037286b51382535bab61680297ed">has_new_data</a>())</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// get absolute heading in degrees</span></div>
<div class="line">                <a class="code hl_struct" href="structbno08x__euler__angle__t.html">bno08x_euler_angle_t</a> euler = imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">rv_game</a>.<a class="code hl_function" href="class_b_n_o08x_rpt_r_v_generic.html#abbaaa6737d578e056f93687d4ad780f7">get_euler</a>();</div>
<div class="line">                <span class="comment">// display heading</span></div>
<div class="line">                ESP_LOGI(TAG, <span class="stringliteral">&quot;Euler Angle: x (roll): %.2f y (pitch): %.2f z (yaw): %.2f&quot;</span>, euler.<a class="code hl_variable" href="structbno08x__euler__angle__t.html#a7c675704f7bf92a19846de6ee020f0ef">x</a>, euler.<a class="code hl_variable" href="structbno08x__euler__angle__t.html#a0c4f19cb559999d4c2ac2b29d9dc7cfd">y</a>, euler.<a class="code hl_variable" href="structbno08x__euler__angle__t.html#a5237ec5e8fc1ca49b2f108ac784f0032">z</a>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// check for cal gyro report</span></div>
<div class="line">            <span class="keywordflow">if</span> (imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a74f6037286b51382535bab61680297ed">has_new_data</a>())</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// get angular velocity in rad/s</span></div>
<div class="line">                <a class="code hl_struct" href="structbno08x__gyro__t.html">bno08x_gyro_t</a> velocity = imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt_cal_gyro.html#aeb45a1a433c499f2c36dddf393175815">get</a>();</div>
<div class="line">                <span class="comment">// display velocity</span></div>
<div class="line">                ESP_LOGW(TAG, <span class="stringliteral">&quot;Velocity: x: %.2f y: %.2f z: %.2f&quot;</span>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#a63a7bfec63a61b44dab94cd62dc5f50e">x</a>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#ab079eb91abc32f71c6d41f3dcf6274df">y</a>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#ac9a349e1dad45c041bfd0555b01e273f">z</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a_b_n_o08x_8hpp_html"><div class="ttname"><a href="_b_n_o08x_8hpp.html">BNO08x.hpp</a></div></div>
<div class="ttc" id="aclass_b_n_o08x_html"><div class="ttname"><a href="class_b_n_o08x.html">BNO08x</a></div><div class="ttdoc">BNO08x IMU driver class.</div><div class="ttdef"><b>Definition</b> BNO08x.hpp:33</div></div>
<div class="ttc" id="aclass_b_n_o08x_html_a367d525d1c0ba119b3dca3067bb5bccc"><div class="ttname"><a href="class_b_n_o08x.html#a367d525d1c0ba119b3dca3067bb5bccc">BNO08x::data_available</a></div><div class="ttdeci">bool data_available()</div><div class="ttdoc">Polls for new data/report to become available.</div><div class="ttdef"><b>Definition</b> BNO08x.cpp:1518</div></div>
<div class="ttc" id="aclass_b_n_o08x_html_ae1db7422ee9c2cac77382cc0a7aa430e"><div class="ttname"><a href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">BNO08x::rpt</a></div><div class="ttdeci">bno08x_reports_t rpt</div><div class="ttdef"><b>Definition</b> BNO08x.hpp:127</div></div>
<div class="ttc" id="aclass_b_n_o08x_html_aea8e2c6dd7a2c9899479a7f39fe94798"><div class="ttname"><a href="class_b_n_o08x.html#aea8e2c6dd7a2c9899479a7f39fe94798">BNO08x::initialize</a></div><div class="ttdeci">bool initialize()</div><div class="ttdoc">Initializes BNO08x sensor.</div><div class="ttdef"><b>Definition</b> BNO08x.cpp:81</div></div>
<div class="ttc" id="aclass_b_n_o08x_rpt_cal_gyro_html_aeb45a1a433c499f2c36dddf393175815"><div class="ttname"><a href="class_b_n_o08x_rpt_cal_gyro.html#aeb45a1a433c499f2c36dddf393175815">BNO08xRptCalGyro::get</a></div><div class="ttdeci">bno08x_gyro_t get()</div><div class="ttdoc">Grabs most recent gyroscope data (velocity), units are in rad/s.</div><div class="ttdef"><b>Definition</b> BNO08xRptCalGyro.cpp:31</div></div>
<div class="ttc" id="aclass_b_n_o08x_rpt_html_a3012b77fd80f2c34e57d5a23299f1470"><div class="ttname"><a href="class_b_n_o08x_rpt.html#a3012b77fd80f2c34e57d5a23299f1470">BNO08xRpt::enable</a></div><div class="ttdeci">bool enable(uint32_t time_between_reports, sh2_SensorConfig_t sensor_cfg=BNO08xPrivateTypes::default_sensor_cfg)</div><div class="ttdoc">Enables a sensor report such that the BNO08x begins sending it.</div><div class="ttdef"><b>Definition</b> BNO08xRpt.cpp:17</div></div>
<div class="ttc" id="aclass_b_n_o08x_rpt_html_a74f6037286b51382535bab61680297ed"><div class="ttname"><a href="class_b_n_o08x_rpt.html#a74f6037286b51382535bab61680297ed">BNO08xRpt::has_new_data</a></div><div class="ttdeci">bool has_new_data()</div><div class="ttdoc">Checks if a new report has been received since the last time this function was called.</div><div class="ttdef"><b>Definition</b> BNO08xRpt.cpp:112</div></div>
<div class="ttc" id="aclass_b_n_o08x_rpt_r_v_generic_html_abbaaa6737d578e056f93687d4ad780f7"><div class="ttname"><a href="class_b_n_o08x_rpt_r_v_generic.html#abbaaa6737d578e056f93687d4ad780f7">BNO08xRptRVGeneric::get_euler</a></div><div class="ttdeci">bno08x_euler_angle_t get_euler(bool in_degrees=true)</div><div class="ttdoc">Grabs most recent rotation vector data in form of an euler angle, units are in degrees or rads.</div><div class="ttdef"><b>Definition</b> BNO08xRptRVGeneric.cpp:36</div></div>
<div class="ttc" id="astruct_b_n_o08x_1_1bno08x__reports__t_html_a7f33ac650137f5933ee1eab1ce936db6"><div class="ttname"><a href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">BNO08x::bno08x_reports_t::rv_game</a></div><div class="ttdeci">BNO08xRptGameRV rv_game</div><div class="ttdef"><b>Definition</b> BNO08x.hpp:81</div></div>
<div class="ttc" id="astruct_b_n_o08x_1_1bno08x__reports__t_html_adabe838126b5bbc83fc4f69bba78123e"><div class="ttname"><a href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">BNO08x::bno08x_reports_t::cal_gyro</a></div><div class="ttdeci">BNO08xRptCalGyro cal_gyro</div><div class="ttdef"><b>Definition</b> BNO08x.hpp:78</div></div>
<div class="ttc" id="astructbno08x__euler__angle__t_html"><div class="ttname"><a href="structbno08x__euler__angle__t.html">bno08x_euler_angle_t</a></div><div class="ttdoc">Struct to represent euler angle (units in degrees or rads)</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:214</div></div>
<div class="ttc" id="astructbno08x__euler__angle__t_html_a0c4f19cb559999d4c2ac2b29d9dc7cfd"><div class="ttname"><a href="structbno08x__euler__angle__t.html#a0c4f19cb559999d4c2ac2b29d9dc7cfd">bno08x_euler_angle_t::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:216</div></div>
<div class="ttc" id="astructbno08x__euler__angle__t_html_a5237ec5e8fc1ca49b2f108ac784f0032"><div class="ttname"><a href="structbno08x__euler__angle__t.html#a5237ec5e8fc1ca49b2f108ac784f0032">bno08x_euler_angle_t::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:217</div></div>
<div class="ttc" id="astructbno08x__euler__angle__t_html_a7c675704f7bf92a19846de6ee020f0ef"><div class="ttname"><a href="structbno08x__euler__angle__t.html#a7c675704f7bf92a19846de6ee020f0ef">bno08x_euler_angle_t::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:215</div></div>
<div class="ttc" id="astructbno08x__gyro__t_html"><div class="ttname"><a href="structbno08x__gyro__t.html">bno08x_gyro_t</a></div><div class="ttdoc">Struct to represent gyro data (units in rad/s)</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:353</div></div>
<div class="ttc" id="astructbno08x__gyro__t_html_a63a7bfec63a61b44dab94cd62dc5f50e"><div class="ttname"><a href="structbno08x__gyro__t.html#a63a7bfec63a61b44dab94cd62dc5f50e">bno08x_gyro_t::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:354</div></div>
<div class="ttc" id="astructbno08x__gyro__t_html_ab079eb91abc32f71c6d41f3dcf6274df"><div class="ttname"><a href="structbno08x__gyro__t.html#ab079eb91abc32f71c6d41f3dcf6274df">bno08x_gyro_t::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:355</div></div>
<div class="ttc" id="astructbno08x__gyro__t_html_ac9a349e1dad45c041bfd0555b01e273f"><div class="ttname"><a href="structbno08x__gyro__t.html#ac9a349e1dad45c041bfd0555b01e273f">bno08x_gyro_t::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition</b> BNO08xGlobalTypes.hpp:356</div></div>
</div><!-- fragment --><ul>
<li>Initialize the IMU and enable desired reports.</li>
<li>Use the <code>data_available()</code> function to poll for new data, similar to the SparkFun library.</li>
<li>Behavior: It is a blocking function that returns <code>true</code> when new data is received or <code>false</code> if a timeout occurs.</li>
<li>Check for report flavor received if desired, with <code>has_new_data()</code></li>
</ul>
<h4><a class="anchor" id="autotoc_md7"></a>
Call-Back Function Example</h4>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_b_n_o08x_8hpp.html">BNO08x.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">constexpr</span> <span class="keywordtype">char</span> *TAG = <span class="stringliteral">&quot;Main&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> app_main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_class" href="class_b_n_o08x.html">BNO08x</a> imu;</div>
<div class="line">    <span class="comment">// if a custom wiring scheme is desired instead of default:</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">    bno08x_config_t imu_config;        //create config struct</span></div>
<div class="line"><span class="comment">    imu_config.io_mosi = GPIO_NUM_X;   //assign pin</span></div>
<div class="line"><span class="comment">    imu_config.io_miso = GPIO_NUM_X;   //assign pin</span></div>
<div class="line"><span class="comment">    //etc...</span></div>
<div class="line"><span class="comment">    BNO08x imu(imu_config);            //pass config to BNO08x constructor</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// initialize imu</span></div>
<div class="line">    <span class="keywordflow">if</span> (!imu.<a class="code hl_function" href="class_b_n_o08x.html#aea8e2c6dd7a2c9899479a7f39fe94798">initialize</a>())</div>
<div class="line">    {</div>
<div class="line">        ESP_LOGE(TAG, <span class="stringliteral">&quot;Init failure, returning from main.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// enable game rotation vector and calibrated gyro reports</span></div>
<div class="line">    imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">rv_game</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a3012b77fd80f2c34e57d5a23299f1470">enable</a>(100000UL);  <span class="comment">// 100,000us == 100ms report interval</span></div>
<div class="line">    imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a3012b77fd80f2c34e57d5a23299f1470">enable</a>(100000UL); <span class="comment">// 100,000us == 100ms report interval</span></div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// There are 3 different flavors of callbacks available:</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 1) register a callback to execute when new data is received for any report</span></div>
<div class="line">    imu.<a class="code hl_function" href="class_b_n_o08x.html#aadd44524e6d22c48916acd9518b63ec3">register_cb</a>([&amp;imu]()</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// check for game rotation vector report</span></div>
<div class="line">                        <span class="keywordflow">if</span> (imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#a7f33ac650137f5933ee1eab1ce936db6">rv_game</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a74f6037286b51382535bab61680297ed">has_new_data</a>())</div>
<div class="line">                        {</div>
<div class="line">                            <span class="comment">// get absolute heading in degrees</span></div>
<div class="line">                            bno08x_euler_angle_t euler = imu.rpt.rv_game.get_euler();</div>
<div class="line">                            <span class="comment">// display heading</span></div>
<div class="line">                            ESP_LOGI(TAG, <span class="stringliteral">&quot;Euler Angle: x (roll): %.2f y (pitch): %.2f z (yaw): %.2f&quot;</span>, euler.x, euler.y, euler.z);</div>
<div class="line">                        } </div>
<div class="line">                    });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2) register a callback that is only executed for a specific report</span></div>
<div class="line">    imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt.html#a5b542b28c81fcd05cf2e3f3d2d437d46">register_cb</a>([&amp;imu]()</div>
<div class="line">                                 {</div>
<div class="line">                                    <span class="comment">// get angular velocity in rad/s</span></div>
<div class="line">                                    <a class="code hl_struct" href="structbno08x__gyro__t.html">bno08x_gyro_t</a> velocity = imu.<a class="code hl_variable" href="class_b_n_o08x.html#ae1db7422ee9c2cac77382cc0a7aa430e">rpt</a>.<a class="code hl_variable" href="struct_b_n_o08x_1_1bno08x__reports__t.html#adabe838126b5bbc83fc4f69bba78123e">cal_gyro</a>.<a class="code hl_function" href="class_b_n_o08x_rpt_cal_gyro.html#aeb45a1a433c499f2c36dddf393175815">get</a>();</div>
<div class="line">                                    <span class="comment">// display velocity</span></div>
<div class="line">                                    ESP_LOGI(TAG, <span class="stringliteral">&quot;Velocity: x: %.2f y: %.2f z: %.2f&quot;</span>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#a63a7bfec63a61b44dab94cd62dc5f50e">x</a>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#ab079eb91abc32f71c6d41f3dcf6274df">y</a>, velocity.<a class="code hl_variable" href="structbno08x__gyro__t.html#ac9a349e1dad45c041bfd0555b01e273f">z</a>); </div>
<div class="line">                                });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 3) register a callback this passed report ID of report that asserted callback</span></div>
<div class="line">    imu.<a class="code hl_function" href="class_b_n_o08x.html#aadd44524e6d22c48916acd9518b63ec3">register_cb</a>([](uint8_t rpt_ID)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">switch</span> (rpt_ID)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">case</span> SH2_GAME_ROTATION_VECTOR:</div>
<div class="line">                                ESP_LOGW(TAG, <span class="stringliteral">&quot;Game RV report RX&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                            <span class="keywordflow">case</span> SH2_CAL_GYRO:</div>
<div class="line">                                ESP_LOGW(TAG, <span class="stringliteral">&quot;Cal Gyro report RX&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                            <span class="keywordflow">default</span>:</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        } </div>
<div class="line">                    });</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        vTaskDelay(10000UL / portTICK_PERIOD_MS); <span class="comment">// delay here is irrelevant, we just don&#39;t want to trip cpu watchdog</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_b_n_o08x_html_aadd44524e6d22c48916acd9518b63ec3"><div class="ttname"><a href="class_b_n_o08x.html#aadd44524e6d22c48916acd9518b63ec3">BNO08x::register_cb</a></div><div class="ttdeci">bool register_cb(std::function&lt; void(void)&gt; cb_fxn)</div><div class="ttdoc">Registers a callback to execute when new data from a report is received.</div><div class="ttdef"><b>Definition</b> BNO08x.cpp:1536</div></div>
<div class="ttc" id="aclass_b_n_o08x_rpt_html_a5b542b28c81fcd05cf2e3f3d2d437d46"><div class="ttname"><a href="class_b_n_o08x_rpt.html#a5b542b28c81fcd05cf2e3f3d2d437d46">BNO08xRpt::register_cb</a></div><div class="ttdeci">bool register_cb(std::function&lt; void(void)&gt; cb_fxn)</div><div class="ttdoc">Registers a callback to execute when new data from a specific report is received.</div><div class="ttdef"><b>Definition</b> BNO08xRpt.cpp:96</div></div>
</div><!-- fragment --><ul>
<li>Register callback functions that automatically execute upon receiving new data.</li>
<li>Behavior: The registered callback will be invoked whenever new data is available.</li>
<li>It is possible to register a callback to one report, or all reports. </li>
</ul>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Unit Tests</h2>
<p align="right">A basic unit testing suite is included with this library, but it is very rudimentary. <br  />
 It can be used to verify some of the basic features of a <a class="el" href="class_b_n_o08x.html" title="BNO08x IMU driver class.">BNO08x</a> device and this library. </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Running Tests</h3>
<ol type="1">
<li>Create a project and add the component as described in the getting started guide.</li>
<li><p class="startli">Open the outermost CMakeLists.txt file in the project root directory, as depicted below. <br  />
</p>
<p class="startli"><img src="README_images/OutermostCMake.png" alt="image" class="inline"/></p>
</li>
<li><p class="startli">Modify the file by adding "set(TEST_COMPONENTS "esp32_BNO08x" CACHE STRING "Components to test.")" as depicted below: <br  />
</p>
<div class="fragment"><div class="line"># For more information about build system see</div>
<div class="line"># https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/build-system.html</div>
<div class="line"># The following five lines of boilerplate have to be in your project&#39;s</div>
<div class="line"># CMakeLists in this exact order for cmake to work correctly</div>
<div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line">set(TEST_COMPONENTS &quot;esp32_BNO08x&quot; CACHE STRING &quot;Components to test.&quot;) </div>
<div class="line">include($ENV{IDF_PATH}/tools/cmake/project.cmake)</div>
<div class="line">project(your_project_name)</div>
</div><!-- fragment --></li>
<li><p class="startli">Include the test suite in your main file and launch into the test suite: <br  />
</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_b_n_o08x_test_suite_8hpp.html">BNO08xTestSuite.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> app_main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="class_b_n_o08x_test_suite.html#ac12545fe311a98e9c0ae6fea77da95fd">BNO08xTestSuite::run_all_tests</a>(); </div>
<div class="line">}</div>
<div class="ttc" id="a_b_n_o08x_test_suite_8hpp_html"><div class="ttname"><a href="_b_n_o08x_test_suite_8hpp.html">BNO08xTestSuite.hpp</a></div></div>
<div class="ttc" id="aclass_b_n_o08x_test_suite_html_ac12545fe311a98e9c0ae6fea77da95fd"><div class="ttname"><a href="class_b_n_o08x_test_suite.html#ac12545fe311a98e9c0ae6fea77da95fd">BNO08xTestSuite::run_all_tests</a></div><div class="ttdeci">static void run_all_tests()</div><div class="ttdef"><b>Definition</b> BNO08xTestSuite.hpp:33</div></div>
</div><!-- fragment --></li>
<li>Ensure you run <code>idf.py fullclean</code> or delete your build directory before building for the first time after modifying the CMakeLists.txt file in step 3.</li>
</ol>
<p>(<a href="#readme-top">back to top</a>)</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Adding Tests</h3>
<p>Tests are implemented with the <a href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-guides/unit-tests.html">unity unit testing component</a>.</p>
<p>To add a test, create a new .cpp file, or modify one of the existing ones in <code>esp32_BNO08x/test/</code>. Follow the existing test structure as an example, use the <code><a class="el" href="_callback_tests_8cpp.html#a10683e9d548d5edb7fa36fcb00515f00">TEST_CASE()</a>{}</code> macro, then add a function to the <code>esp32BNO08x/include/BNO08xTestSuite.hpp</code> file to run your test(s). <br  />
</p>
<p align="right">Any tests added will automatically be detected at build time. </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Documentation</h2>
<p align="right">API documentation generated with doxygen can be found in the documentation directory of the master branch. <br  />
 </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Program Flowcharts</h2>
<p>The following charts illustrate the program flow this library implements to deal with handling reports from the IMU in a multi-tasked manner. These are here to aid development for anyone looking to modify, fork, or contribute. <br  />
 Sh2 HAL lib handles all communication with the IMU through callbacks which can be viewed in <code><a class="el" href="_b_n_o08x_s_h2_h_a_l_8hpp.html">BNO08xSH2HAL.hpp</a></code>.</p>
<p align="right"><img src="README_images/esp32_BNO08x_flowchart.png" alt="image" class="inline"/> </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Acknowledgements</h2>
<p>Special thanks to Anton Babiy, aka hwBirdy007 for helping with debugging SPI. <br  />
 <a href="https://github.com/hwBirdy007">https://github.com/hwBirdy007</a> <br  />
</p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md14"></a>
License</h2>
<p align="right">Distributed under the MIT License. See <code>LICENSE.md</code> for more information. </p>
<p>(<a href="#readme-top">back to top</a>)</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Contact</h2>
<p>Myles Parfeniuk - <a href="#" onclick="location.href='mai'+'lto:'+'myl'+'es'+'.pa'+'rf'+'eny'+'uk'+'@gm'+'ai'+'l.c'+'om'; return false;">myles<span class="obfuscator">.nosp@m.</span>.par<span class="obfuscator">.nosp@m.</span>fenyu<span class="obfuscator">.nosp@m.</span>k@gm<span class="obfuscator">.nosp@m.</span>ail.c<span class="obfuscator">.nosp@m.</span>om</a></p>
<p align="right">Project Link: <a href="https://github.com/myles-parfeniuk/esp32_BNO08x.git">https://github.com/myles-parfeniuk/esp32_BNO08x.git</a> </p>
<p>(<a href="#readme-top">back to top</a>)</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
